<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Android开发-Gradle打包流程及自定义构建梳理 | 黎子的小屋</title><meta name="description" content="Android开发-Gradle打包流程及自定义构建梳理"><meta name="keywords" content="Android,Gradle"><meta name="author" content="laird.li,laird.li@foxmail.com"><meta name="copyright" content="laird.li"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://hm.baidu.com"><link rel="preconnect" href="https://ta.qq.com"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Android开发-Gradle打包流程及自定义构建梳理"><meta name="twitter:description" content="Android开发-Gradle打包流程及自定义构建梳理"><meta name="twitter:image" content="https://s1.ax1x.com/2020/05/18/YW0odg.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Android开发-Gradle打包流程及自定义构建梳理"><meta property="og:url" content="https://lairdli.top/2020/02/02/Android-Gradle/"><meta property="og:site_name" content="黎子的小屋"><meta property="og:description" content="Android开发-Gradle打包流程及自定义构建梳理"><meta property="og:image" content="https://s1.ax1x.com/2020/05/18/YW0odg.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://lairdli.top/2020/02/02/Android-Gradle/"><link rel="prev" title="脚本工具-仓储迁移svn转git脚本" href="https://lairdli.top/2020/04/25/Script-Svn2Git/"><link rel="next" title="部门协作-团队组建与管理" href="https://lairdli.top/2019/11/24/Soft-Team-Manager/"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?3b0d245d987b30fdca805247f64d0ed3";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script src="https://tajs.qq.com/stats?sId=66530243" charset="UTF-8"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://lairdli.top/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"title":"Snackbar.bookmark.title","message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">黎子的小屋</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">23</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">24</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">8</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#前言"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">前言</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#构建"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">构建</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#ant"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">ant</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#maven"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">maven</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#make"><span class="toc_mobile_items-number">2.3.</span> <span class="toc_mobile_items-text">make</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Gradle"><span class="toc_mobile_items-number">2.4.</span> <span class="toc_mobile_items-text">Gradle</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#Groovy"><span class="toc_mobile_items-number">2.4.1.</span> <span class="toc_mobile_items-text">Groovy</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#Groovy-基本语言"><span class="toc_mobile_items-number">2.4.2.</span> <span class="toc_mobile_items-text">Groovy-基本语言</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#Groovy-集合"><span class="toc_mobile_items-number">2.4.3.</span> <span class="toc_mobile_items-text">Groovy-集合</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#Groovy-闭包"><span class="toc_mobile_items-number">2.4.4.</span> <span class="toc_mobile_items-text">Groovy-闭包</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#Android-Gradle"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">Android-Gradle</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#app-build编译打包流程"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text">app-build编译打包流程</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#gradle打包流程"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text">gradle打包流程</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#project-setting-gradle-项目配置"><span class="toc_mobile_items-number">3.3.</span> <span class="toc_mobile_items-text">project-setting.gradle 项目配置</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#project-build-gradle-项目初始化"><span class="toc_mobile_items-number">3.4.</span> <span class="toc_mobile_items-text">project-build.gradle 项目初始化</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#app-buid-grade-应用编译"><span class="toc_mobile_items-number">3.5.</span> <span class="toc_mobile_items-text">app-buid.grade 应用编译</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#lib-build-gradle-库模块编译"><span class="toc_mobile_items-number">3.6.</span> <span class="toc_mobile_items-text">lib-build.gradle 库模块编译</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#auto-package-自动打包"><span class="toc_mobile_items-number">3.7.</span> <span class="toc_mobile_items-text">auto-package 自动打包</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#key-store-秘钥配置"><span class="toc_mobile_items-number">3.8.</span> <span class="toc_mobile_items-text">key-store 秘钥配置</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#module-config-模块化配置"><span class="toc_mobile_items-number">3.9.</span> <span class="toc_mobile_items-text">module-config 模块化配置</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#setting-gradle-模块化配置"><span class="toc_mobile_items-number">3.9.1.</span> <span class="toc_mobile_items-text">setting.gradle 模块化配置</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#build-gradle模块化配置"><span class="toc_mobile_items-number">3.9.2.</span> <span class="toc_mobile_items-text">build.gradle模块化配置</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#Project-build-gradle"><span class="toc_mobile_items-number">3.9.2.1.</span> <span class="toc_mobile_items-text">Project-build.gradle</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-6"><a class="toc_mobile_items-link" href="#util-gradle"><span class="toc_mobile_items-number">3.9.2.1.1.</span> <span class="toc_mobile_items-text">util.gradle</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-6"><a class="toc_mobile_items-link" href="#cvs-gradle"><span class="toc_mobile_items-number">3.9.2.1.2.</span> <span class="toc_mobile_items-text">cvs.gradle</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-6"><a class="toc_mobile_items-link" href="#config-gradle"><span class="toc_mobile_items-number">3.9.2.1.3.</span> <span class="toc_mobile_items-text">config.gradle</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#modlue-app-build-gradle"><span class="toc_mobile_items-number">3.9.2.2.</span> <span class="toc_mobile_items-text">modlue-app-build.gradle</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-6"><a class="toc_mobile_items-link" href="#app-gradle"><span class="toc_mobile_items-number">3.9.2.2.1.</span> <span class="toc_mobile_items-text">app.gradle</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-6"><a class="toc_mobile_items-link" href="#build-gradle"><span class="toc_mobile_items-number">3.9.2.2.2.</span> <span class="toc_mobile_items-text">build.gradle</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#modlue-lib-build-gradle"><span class="toc_mobile_items-number">3.9.2.3.</span> <span class="toc_mobile_items-text">modlue-lib-build.gradle</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-6"><a class="toc_mobile_items-link" href="#lib-gradle"><span class="toc_mobile_items-number">3.9.2.3.1.</span> <span class="toc_mobile_items-text">lib.gradle</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-6"><a class="toc_mobile_items-link" href="#build-gradle-1"><span class="toc_mobile_items-number">3.9.2.3.2.</span> <span class="toc_mobile_items-text">build.gradle</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#Modlue-lib-debug-build-gradle"><span class="toc_mobile_items-number">3.9.2.4.</span> <span class="toc_mobile_items-text">Modlue-lib(debug)-build.gradle</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-6"><a class="toc_mobile_items-link" href="#libdebug-gradle"><span class="toc_mobile_items-number">3.9.2.4.1.</span> <span class="toc_mobile_items-text">libdebug.gradle</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-6"><a class="toc_mobile_items-link" href="#build-gradle-2"><span class="toc_mobile_items-number">3.9.2.4.2.</span> <span class="toc_mobile_items-text">build.gradle</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-6"><a class="toc_mobile_items-link" href="#aRouter"><span class="toc_mobile_items-number">3.9.2.4.3.</span> <span class="toc_mobile_items-text">aRouter</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-6"><a class="toc_mobile_items-link" href="#Application"><span class="toc_mobile_items-number">3.9.2.4.4.</span> <span class="toc_mobile_items-text">Application</span></a></li></ol></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#eclipse-translate-旧工程迁移"><span class="toc_mobile_items-number">3.10.</span> <span class="toc_mobile_items-text">eclipse-translate 旧工程迁移</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#1-脚本拷贝"><span class="toc_mobile_items-number">3.10.1.</span> <span class="toc_mobile_items-text">1. 脚本拷贝</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#2-项目配置"><span class="toc_mobile_items-number">3.10.2.</span> <span class="toc_mobile_items-text">2. 项目配置</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#3-配置模块build-gradle"><span class="toc_mobile_items-number">3.10.3.</span> <span class="toc_mobile_items-text">3. 配置模块build.gradle</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#源码路径"><span class="toc_mobile_items-number">3.10.3.1.</span> <span class="toc_mobile_items-text">源码路径</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#依赖配置"><span class="toc_mobile_items-number">3.10.3.2.</span> <span class="toc_mobile_items-text">依赖配置</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#编译配置"><span class="toc_mobile_items-number">3.10.3.3.</span> <span class="toc_mobile_items-text">编译配置</span></a></li></ol></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#后记"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">后记</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#示例-androidgradle"><span class="toc_mobile_items-number">4.1.</span> <span class="toc_mobile_items-text">示例-androidgradle</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#在线浏览-androidgradle"><span class="toc_mobile_items-number">4.2.</span> <span class="toc_mobile_items-text">在线浏览-androidgradle</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#参考"><span class="toc_mobile_items-number">4.3.</span> <span class="toc_mobile_items-text">参考</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#构建"><span class="toc-number">2.</span> <span class="toc-text">构建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ant"><span class="toc-number">2.1.</span> <span class="toc-text">ant</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#maven"><span class="toc-number">2.2.</span> <span class="toc-text">maven</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#make"><span class="toc-number">2.3.</span> <span class="toc-text">make</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gradle"><span class="toc-number">2.4.</span> <span class="toc-text">Gradle</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Groovy"><span class="toc-number">2.4.1.</span> <span class="toc-text">Groovy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Groovy-基本语言"><span class="toc-number">2.4.2.</span> <span class="toc-text">Groovy-基本语言</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Groovy-集合"><span class="toc-number">2.4.3.</span> <span class="toc-text">Groovy-集合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Groovy-闭包"><span class="toc-number">2.4.4.</span> <span class="toc-text">Groovy-闭包</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Android-Gradle"><span class="toc-number">3.</span> <span class="toc-text">Android-Gradle</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#app-build编译打包流程"><span class="toc-number">3.1.</span> <span class="toc-text">app-build编译打包流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gradle打包流程"><span class="toc-number">3.2.</span> <span class="toc-text">gradle打包流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#project-setting-gradle-项目配置"><span class="toc-number">3.3.</span> <span class="toc-text">project-setting.gradle 项目配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#project-build-gradle-项目初始化"><span class="toc-number">3.4.</span> <span class="toc-text">project-build.gradle 项目初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#app-buid-grade-应用编译"><span class="toc-number">3.5.</span> <span class="toc-text">app-buid.grade 应用编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lib-build-gradle-库模块编译"><span class="toc-number">3.6.</span> <span class="toc-text">lib-build.gradle 库模块编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#auto-package-自动打包"><span class="toc-number">3.7.</span> <span class="toc-text">auto-package 自动打包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#key-store-秘钥配置"><span class="toc-number">3.8.</span> <span class="toc-text">key-store 秘钥配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#module-config-模块化配置"><span class="toc-number">3.9.</span> <span class="toc-text">module-config 模块化配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#setting-gradle-模块化配置"><span class="toc-number">3.9.1.</span> <span class="toc-text">setting.gradle 模块化配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#build-gradle模块化配置"><span class="toc-number">3.9.2.</span> <span class="toc-text">build.gradle模块化配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Project-build-gradle"><span class="toc-number">3.9.2.1.</span> <span class="toc-text">Project-build.gradle</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#util-gradle"><span class="toc-number">3.9.2.1.1.</span> <span class="toc-text">util.gradle</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#cvs-gradle"><span class="toc-number">3.9.2.1.2.</span> <span class="toc-text">cvs.gradle</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#config-gradle"><span class="toc-number">3.9.2.1.3.</span> <span class="toc-text">config.gradle</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#modlue-app-build-gradle"><span class="toc-number">3.9.2.2.</span> <span class="toc-text">modlue-app-build.gradle</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#app-gradle"><span class="toc-number">3.9.2.2.1.</span> <span class="toc-text">app.gradle</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#build-gradle"><span class="toc-number">3.9.2.2.2.</span> <span class="toc-text">build.gradle</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#modlue-lib-build-gradle"><span class="toc-number">3.9.2.3.</span> <span class="toc-text">modlue-lib-build.gradle</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#lib-gradle"><span class="toc-number">3.9.2.3.1.</span> <span class="toc-text">lib.gradle</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#build-gradle-1"><span class="toc-number">3.9.2.3.2.</span> <span class="toc-text">build.gradle</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Modlue-lib-debug-build-gradle"><span class="toc-number">3.9.2.4.</span> <span class="toc-text">Modlue-lib(debug)-build.gradle</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#libdebug-gradle"><span class="toc-number">3.9.2.4.1.</span> <span class="toc-text">libdebug.gradle</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#build-gradle-2"><span class="toc-number">3.9.2.4.2.</span> <span class="toc-text">build.gradle</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#aRouter"><span class="toc-number">3.9.2.4.3.</span> <span class="toc-text">aRouter</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Application"><span class="toc-number">3.9.2.4.4.</span> <span class="toc-text">Application</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#eclipse-translate-旧工程迁移"><span class="toc-number">3.10.</span> <span class="toc-text">eclipse-translate 旧工程迁移</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-脚本拷贝"><span class="toc-number">3.10.1.</span> <span class="toc-text">1. 脚本拷贝</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-项目配置"><span class="toc-number">3.10.2.</span> <span class="toc-text">2. 项目配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-配置模块build-gradle"><span class="toc-number">3.10.3.</span> <span class="toc-text">3. 配置模块build.gradle</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#源码路径"><span class="toc-number">3.10.3.1.</span> <span class="toc-text">源码路径</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#依赖配置"><span class="toc-number">3.10.3.2.</span> <span class="toc-text">依赖配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#编译配置"><span class="toc-number">3.10.3.3.</span> <span class="toc-text">编译配置</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#后记"><span class="toc-number">4.</span> <span class="toc-text">后记</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#示例-androidgradle"><span class="toc-number">4.1.</span> <span class="toc-text">示例-androidgradle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在线浏览-androidgradle"><span class="toc-number">4.2.</span> <span class="toc-text">在线浏览-androidgradle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参考"><span class="toc-number">4.3.</span> <span class="toc-text">参考</span></a></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://s1.ax1x.com/2020/05/18/YW0odg.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">Android开发-Gradle打包流程及自定义构建梳理</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2020-02-02<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-05-17</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Android/">Android</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">6.8k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 29 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文将简述Android-Gradle在实际项目开发过程中-打包编译过程中-所涉及到的部分知识点。<br>对大部分Android开发者而言，接触Gradle应该是从AndroidStudio开始，而AndroidStudio是google官方推荐的开发IDE,可见深入了解Gradle会对我们的Android软件开发产生更深远的意义。<br>Gradle其实是一种构建工具，能自动化的进行构建，编译，打包，签名等一系列流程。</p>
<a id="more"></a>

<h2 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h2><p>构建工具用于实现项目自动化，是一种可编程的工具，你可以用代码来控制构建流程最终生成可交付的软件。构建工具可以帮助你创建一个重复的、可靠的、无需手动介入的、不依赖于特定操作系统和IDE的构建。Android开发中常见构建工具有ant,maven,make,gradle等等。</p>
<h3 id="ant"><a href="#ant" class="headerlink" title="ant"></a>ant</h3><p>Ant 是由 Java 编写的构建工具，具有平台无关性，构建脚本是XML格式的（默认为bulid.xml）。Ant的构建脚本由三个基本元素组成：一个project（工程）、多个target（目标）和可用的task（任务）。<br>Apache Ant有以下缺点：</p>
<blockquote>
<ol>
<li>Ant无法获取运行时的信息。</li>
<li>XML作为构建脚本的语言，如果构建逻辑复杂，那么构建脚本就会又长又难以维护。</li>
<li>Ant管理依赖需要配合Ivy。</li>
<li>Ant脚本编写虽然具有灵活性，但不易于结构化理解。</li>
</ol>
</blockquote>
<h3 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h3><p>Maven于2004年发布，它的目标是改进开发人员在使用Ant时面临的一些问题。 继承了Ant的项目构建功能， 同样采用了XML作为构建脚本的格式(默认为pom.xml)。Maven具有依赖管理和项目管理的功能，提供了中央仓库，能帮助我们自动下载库文件。</p>
<p>Maven相比Ant的优点：</p>
<blockquote>
<ol>
<li>Ant是过程式的，开发者需要显示的指定每个目标，以及完成该目标锁需要执行的任务。每一个项目，开发着都需要重新编写这一过程，这样会产生大量的重复。Maven是声明式的，项目的构建过程和过程中的各个阶段都由插件实现，开发者只需要声明项目的基本元素就可以了，这很大程度消除了重复。</li>
<li>Ant需要配合Ivy来管理依赖，而Maven本身就提供了依赖管理。</li>
<li>Maven 使用约定而不是配置，它为工程提供了合理的默认行为，项目会知道去哪个目录寻找源代码以及构建运行时有那些任务去执行。而Ant是使用配置且没有默认行为的。</li>
</ol>
</blockquote>
<p>Maven的缺点：</p>
<blockquote>
<ol>
<li>Maven的提供了一套默认的结构和生命周期，对具体的项目工程有些可能会有不适应。</li>
<li>Maven的定制扩展过于繁琐不易于理解。</li>
<li>国内连接Maven的中央仓库比较慢，一般需要连接国内的Maven镜像仓库，目前有阿里云仓储等可做备选。</li>
</ol>
</blockquote>
<h3 id="make"><a href="#make" class="headerlink" title="make"></a>make</h3><p>Make编译构建，在Android的源码编译中被大量使用，其采用Makefile作为构建脚本的格式语言（默认为Android.mk），执行对应的命令，然后得到目标产物。除了make命令外，Android源码编译中还有mm,mmm等。</p>
<blockquote>
<ol>
<li><strong>make：</strong>不带任何参数，用于编译整个系统，编译时间比较长，除非是进行初次编译否则不建议此种做法</li>
<li><strong>mmm</strong>  该命令编译指定目录下的目标模块，而不编译它所依赖其他模块。非首次编译可能会依赖报错</li>
<li><strong>mm</strong> 同mmm 命令一样也是不编译依赖，只是该命令需先cd到编译目录,编译当前目录。</li>
<li><strong>mma</strong>  也是编译当前目录下的模块，但会编译其依赖项</li>
</ol>
</blockquote>
<p>默认编译一般都是增量变化式编译，若需重新编译 以上命令都可以用-B选项来实现。</p>
<p>在这顺便提下源码编译的流程</p>
<blockquote>
<ol>
<li>source build/envsetup.sh  #这个脚本用来设置android的编译环境; </li>
<li>lunch #选择编译目标 </li>
<li>make #编译android整个系统</li>
</ol>
</blockquote>
<p>make编译优缺点：</p>
<blockquote>
<ol>
<li>方便管理编译依赖大型项目。</li>
<li>make编译需依赖linux等一系列编译工具，跨平台搭建会比较复杂。</li>
<li>对于单个Android应用项目独立编译，需要有源码编译环境，不易于调试。</li>
</ol>
</blockquote>
<h3 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h3><p>gradle结合Ant和Maven等构建工具的最佳特性。它有着约定优于配置的方法、强大的依赖管理，它的构建脚本使用Groovy或Kotlin 编写，是Android的官方构建工具。gradle脚本为<strong>build.gradle</strong>格式。</p>
<h4 id="Groovy"><a href="#Groovy" class="headerlink" title="Groovy"></a>Groovy</h4><p>Groovy基于DSL(动态语言)。和Java一样，也运行于Java虚拟机中。这一特性也使得Groovy可以引用Java，但除此之外Groovy又具有脚本语言的特定。当执行Groovy脚本时，Groovy会先将其编译成Java类字节码，然后通过Jvm来执行这个Java类。相关关系模型如下图</p>
<p><a href="https://s1.ax1x.com/2020/05/18/YWBKFH.png" target="_blank" rel="noopener" data-fancybox="group" data-caption="groovy-jvm" class="fancybox"><img alt="groovy-jvm" data-src="https://s1.ax1x.com/2020/05/18/YWBKFH.png" class="lazyload" title="groovy-jvm"></a></p>
<h4 id="Groovy-基本语言"><a href="#Groovy-基本语言" class="headerlink" title="Groovy-基本语言"></a>Groovy-基本语言</h4><p>作为动态语言，Groovy世界中的所有事物都是对象。所以，int，boolean这些Java中的基本数据类型，在Groovy代码中其实对应的是它们的包装数据类型。比如int对应为Integer，boolean对应为Boolean等。</p>
<h4 id="Groovy-集合"><a href="#Groovy-集合" class="headerlink" title="Groovy-集合"></a>Groovy-集合</h4><ul>
<li><p>List：链表，其底层对应Java中的List接口，一般用ArrayList作为真正的实现类。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//List由[]定义，其元素可以是任何对象</span></span><br><span class="line"><span class="comment">//变量存取：可以直接通过索引存取，而且不用担心索引越界。</span></span><br><span class="line"><span class="comment">//如果索引超过当前链表长度，List会自动往该索引添加元素</span></span><br><span class="line"><span class="keyword">def</span> arryList = [<span class="number">2</span>,<span class="string">'string'</span>,<span class="literal">true</span>] </span><br><span class="line"><span class="keyword">assert</span> arryList[<span class="number">1</span>] == <span class="string">'string'</span></span><br><span class="line"><span class="keyword">assert</span> arryList[<span class="number">5</span>] == <span class="literal">null</span> <span class="comment">//第6个元素为空</span></span><br><span class="line">aList[<span class="number">100</span>] = <span class="number">100</span> <span class="comment">//设置第101个元素的值为10</span></span><br><span class="line"><span class="keyword">assert</span> arryList[<span class="number">100</span>] == <span class="number">100</span></span><br><span class="line">println arryList.size  ===>结果是<span class="number">101</span></span><br></pre></td></tr></tbody></table></figure></div>
</li>
<li><p>Map：键-值表，其底层对应Java中的LinkedHashMap。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//容器变量定义</span></span><br><span class="line"><span class="comment">//变量定义：Map变量由[:]定义，比如</span></span><br><span class="line"><span class="keyword">def</span> aMap = [<span class="string">'key1'</span>:<span class="string">'value1'</span>,<span class="string">'key2'</span>:<span class="literal">true</span>]</span><br><span class="line"><span class="comment">//Map由[:]定义，注意其中的冒号。冒号左边是key，右边是Value。key必须是字符串，value可以是任何对象。另外，key可以用''或""包起来，也可以不用引号包起来。比如</span></span><br><span class="line"><span class="keyword">def</span> aNewMap = [<span class="string">key1:</span><span class="string">"value"</span>,<span class="string">key2:</span><span class="literal">true</span>]</span><br></pre></td></tr></tbody></table></figure></div>
</li>
<li><p>Range：范围，它其实是List的一种拓展。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Range类型的变量 由begin值+两个点+end值表示</span></span><br><span class="line"><span class="comment">//左边这个aRange包含1,2,3,4,5这5个值</span></span><br><span class="line"><span class="keyword">def</span> aRange = <span class="number">1.</span><span class="number">.5</span> </span><br><span class="line"><span class="comment">//如果不想包含最后一个元素，包含1,2,3,4这4个元素</span></span><br><span class="line"><span class="keyword">def</span> aRangeWithoutEnd = <span class="number">1.</span>.<<span class="number">5</span>  </span><br><span class="line">println aRange.from</span><br><span class="line">println aRange.to</span><br></pre></td></tr></tbody></table></figure></div>

</li>
</ul>
<h4 id="Groovy-闭包"><a href="#Groovy-闭包" class="headerlink" title="Groovy-闭包"></a>Groovy-闭包</h4><p>闭包，英文叫Closure，是Groovy中非常重要的一个数据类型或者说一种概念。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> closure = {<span class="comment">//闭包是一段代码，所以需要用花括号括起来..</span></span><br><span class="line">    Stringparam1, <span class="keyword">int</span> param2 ->  <span class="comment">//这个箭头很关键。箭头前面是参数定义，箭头后面是代码</span></span><br><span class="line">    println<span class="string">"this is code"</span> <span class="comment">//这是代码，最后一句是返回值，</span></span><br><span class="line">   <span class="comment">//也可以使用return，和Groovy中普通函数一样</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>简而言之，Closure的定义格式是：</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> xxx = {paramters -> code} <span class="comment">//或者 def xxx = {无参数，纯code} 这种case不需要->符号</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>Closure使用中的注意点</p>
<ol>
<li>省略圆括号</li>
<li>确定Closure的参数</li>
</ol>
<p>更详细的接受可以参考文末的参考文档链接。</p>
<h2 id="Android-Gradle"><a href="#Android-Gradle" class="headerlink" title="Android-Gradle"></a>Android-Gradle</h2><p>好了有了以上相关构建的基础知识，现在让我们走进今天的主角AS-Android-Gradle<br>在学习Android-Gradle编译流程前，有必要先梳理下APP编译打包的具体流程。</p>
<h3 id="app-build编译打包流程"><a href="#app-build编译打包流程" class="headerlink" title="app-build编译打包流程"></a>app-build编译打包流程</h3><p><a href="https://s1.ax1x.com/2020/05/18/YWBQfA.png" target="_blank" rel="noopener" data-fancybox="group" data-caption="android-compile" class="fancybox"><img alt="android-compile" data-src="https://s1.ax1x.com/2020/05/18/YWBQfA.png" class="lazyload" title="android-compile"></a></p>
<p>APK构建过程如上图总结如下：</p>
<blockquote>
<ol>
<li>通过AAPT(Android Asset Packaging Tool)打包res资源文件，比如AndroidManifest.xml、xml布局文件等，并将这些xml文件编译为二进制，其中assets和raw文件夹的文件不会被编译为二进制，最终会生成R.java和resources.arsc文件。</li>
<li>AIDL工具会将所有的aidl接口转化为对应的Java接口。</li>
<li>所有的Java代码，包括R.java和Java接口都会被Java编译器编译成.class文件。</li>
<li>Dex工具会将上一步生成的.class文件、第三库和其他.class文件编译成.dex文件。</li>
<li>上一步编译生成的.dex文件、编译过的资源、无需编译的资源（如图片等）会被ApkBuilder工具打包成APK文件。</li>
<li>使用Debug Keystore或者Release Keystore对上一步生成的APK文件进行签名。</li>
<li>如果是对APK正式签名，还需要使用zipalign工具对APK进行对齐操作，这样应用运行时会减少内存的开销。</li>
</ol>
</blockquote>
<h3 id="gradle打包流程"><a href="#gradle打包流程" class="headerlink" title="gradle打包流程"></a>gradle打包流程</h3><p><a href="https://s1.ax1x.com/2020/05/18/YWBYm8.png" target="_blank" rel="noopener" data-fancybox="group" data-caption="img" class="fancybox"><img alt="img" data-src="https://s1.ax1x.com/2020/05/18/YWBYm8.png" class="lazyload" title="img"></a></p>
<blockquote>
<ol>
<li>首先是初始化阶段。执行as项目根目录下的settings.gradle</li>
<li>Initiliazation phase的下一个阶段是Configration阶段。</li>
<li>Configration阶段的目标是解析每个project中的build.gradle。解析每个子 模块中的build.gradle。在这两个阶段之间，我们可以加一些定制化的Hook。这当然是通过API来添加的。</li>
<li>Configuration阶段完了后，整个build的project以及内部的Task关系就确定了。当然，我们也可以添加一个HOOK，即当Task关系图建立好后，执行一些操作。</li>
<li>最后一个阶段就是执行任务了。当然，任务执行完后，我们还是可以加Hook。</li>
</ol>
</blockquote>
<h3 id="project-setting-gradle-项目配置"><a href="#project-setting-gradle-项目配置" class="headerlink" title="project-setting.gradle 项目配置"></a>project-setting.gradle 项目配置</h3><p>gradle项目初始化工作，一切从这里开始。创建modlue时，as会默认在setting.gradle中include相关模块</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">include <span class="string">':testlibrary'</span>,  <span class="string">':testapplication'</span>, <span class="string">':testapplication1'</span>, <span class="string">':testlibrary1'</span></span><br><span class="line">rootProject.name=<span class="string">'AndroidGradle'</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="project-build-gradle-项目初始化"><a href="#project-build-gradle-项目初始化" class="headerlink" title="project-build.gradle 项目初始化"></a>project-build.gradle 项目初始化</h3><p>项目下的build.gradle,是一个整体配置，各模块编译前后的一些公共Task可在此定义</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span></span><br><span class="line"></span><br><span class="line">buildscript {</span><br><span class="line">    repositories {</span><br><span class="line">        google()</span><br><span class="line">        jcenter()</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">    dependencies {</span><br><span class="line">        classpath <span class="string">'com.android.tools.build:gradle:3.5.0'</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// <span class="doctag">NOTE:</span> Do not place your application dependencies here; they belong</span></span><br><span class="line">        <span class="comment">// in the individual module build.gradle files</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">allprojects {</span><br><span class="line">    repositories {</span><br><span class="line">        google()</span><br><span class="line">        jcenter()</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">task clean(<span class="string">type:</span> Delete) {</span><br><span class="line">    delete rootProject.buildDir</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>再这一模块，可以自定义一些task,或修改task</p>
<p>比如新增maven仓储,或编译task</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">allprojects {</span><br><span class="line">    repositories {</span><br><span class="line">        <span class="comment">//新增阿里云仓储</span></span><br><span class="line">        maven{ url <span class="string">'http://maven.aliyun.com/nexus/content/groups/public/'</span>}</span><br><span class="line">        google()</span><br><span class="line">        jcenter()</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//增加一些编译选项</span></span><br><span class="line">    gradle.projectsEvaluated {</span><br><span class="line">        tasks.withType(JavaCompile) {</span><br><span class="line">            options.compilerArgs << <span class="string">"-Xlint:unchecked"</span> << <span class="string">"-Xlint:deprecation"</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure></div>

<p>比如重新修改clean Task,默认的clean的之后删除根目录下的buildDir，但对于模块下的build未删除</p>
<p>对于正在使用svn进行代码管理时，上传代码时，如果不删除build，svn扫描文件会很卡。</p>
<p>因而重新编写task后也会递归删除相关子模块下的build。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">task clean(<span class="string">type:</span> Delete) {</span><br><span class="line">    println <span class="string">"\n======================================================"</span></span><br><span class="line">    println <span class="string">"**********  Delete All Compile ********** "</span></span><br><span class="line">    println <span class="string">"======================================================\n"</span></span><br><span class="line"></span><br><span class="line">    println(<span class="string">"**********  start delete "</span>)</span><br><span class="line">    println(<span class="string">"delete project dir:"</span> + rootProject.buildDir)</span><br><span class="line">    rootProject.buildDir.deleteDir()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> file = <span class="keyword">new</span> File(<span class="string">""</span>)</span><br><span class="line">    <span class="keyword">def</span> dir = <span class="keyword">new</span> File(file.getAbsolutePath())</span><br><span class="line">    println(<span class="string">" root dir:"</span> +dir.getAbsolutePath())</span><br><span class="line"></span><br><span class="line">    dir.eachDirRecurse {</span><br><span class="line">        dir2 -></span><br><span class="line">            dir2.eachDirMatch(<span class="regexp">~/build/</span>) {</span><br><span class="line">                directory -></span><br><span class="line">                        println(<span class="string">"delete child dir:"</span>+directory)</span><br><span class="line">                                            directory.deleteDir()</span><br><span class="line">            }</span><br><span class="line">    }</span><br><span class="line">    println(<span class="string">"********** finished delete"</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>



<h3 id="app-buid-grade-应用编译"><a href="#app-buid-grade-应用编译" class="headerlink" title="app-buid.grade 应用编译"></a>app-buid.grade 应用编译</h3><p>应用模块的编译配置脚本。对比编译版本，编译工具，签名，渠道配置等都可以在此配置。但对于多模块配置而言，经常会出现版本号不统一的情况，为了解决这个问题，我们可以把版本号定义在project-gradle-ext全局变量中。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">'com.android.application'</span></span><br><span class="line"></span><br><span class="line">android {</span><br><span class="line">    compileSdkVersion <span class="number">28</span></span><br><span class="line">    buildToolsVersion <span class="string">"29.0.2"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    defaultConfig {</span><br><span class="line">        applicationId <span class="string">"top.lairdli.study.testapplication"</span></span><br><span class="line">        minSdkVersion <span class="number">15</span></span><br><span class="line">        targetSdkVersion <span class="number">28</span></span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName <span class="string">"1.0"</span></span><br><span class="line"></span><br><span class="line">        testInstrumentationRunner <span class="string">"androidx.test.runner.AndroidJUnitRunner"</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    buildTypes {</span><br><span class="line">        release {</span><br><span class="line">            minifyEnabled <span class="literal">false</span></span><br><span class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android-optimize.txt'</span>), <span class="string">'proguard-rules.pro'</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">dependencies {</span><br><span class="line">    implementation fileTree(<span class="string">dir:</span> <span class="string">'libs'</span>, <span class="string">include:</span> [<span class="string">'*.jar'</span>])</span><br><span class="line"></span><br><span class="line">    implementation <span class="string">'androidx.appcompat:appcompat:1.0.2'</span></span><br><span class="line">    implementation <span class="string">'androidx.constraintlayout:constraintlayout:1.1.3'</span></span><br><span class="line">    testImplementation <span class="string">'junit:junit:4.12'</span></span><br><span class="line">    androidTestImplementation <span class="string">'androidx.test:runner:1.1.1'</span></span><br><span class="line">    androidTestImplementation <span class="string">'androidx.test.espresso:espresso-core:3.1.1'</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="lib-build-gradle-库模块编译"><a href="#lib-build-gradle-库模块编译" class="headerlink" title="lib-build.gradle 库模块编译"></a>lib-build.gradle 库模块编译</h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">'com.android.library'</span></span><br><span class="line"></span><br><span class="line">android {</span><br><span class="line">    compileSdkVersion <span class="number">28</span></span><br><span class="line">    buildToolsVersion <span class="string">"29.0.2"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    defaultConfig {</span><br><span class="line">        minSdkVersion <span class="number">15</span></span><br><span class="line">        targetSdkVersion <span class="number">28</span></span><br><span class="line">        versionCode <span class="number">1</span></span><br><span class="line">        versionName <span class="string">"1.0"</span></span><br><span class="line"></span><br><span class="line">        testInstrumentationRunner <span class="string">"androidx.test.runner.AndroidJUnitRunner"</span></span><br><span class="line">        consumerProguardFiles <span class="string">'consumer-rules.pro'</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    buildTypes {</span><br><span class="line">        release {</span><br><span class="line">            minifyEnabled <span class="literal">false</span></span><br><span class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android-optimize.txt'</span>), <span class="string">'proguard-rules.pro'</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">dependencies {</span><br><span class="line">    implementation fileTree(<span class="string">dir:</span> <span class="string">'libs'</span>, <span class="string">include:</span> [<span class="string">'*.jar'</span>])</span><br><span class="line"></span><br><span class="line">    implementation <span class="string">'androidx.appcompat:appcompat:1.0.2'</span></span><br><span class="line">    testImplementation <span class="string">'junit:junit:4.12'</span></span><br><span class="line">    androidTestImplementation <span class="string">'androidx.test:runner:1.1.1'</span></span><br><span class="line">    androidTestImplementation <span class="string">'androidx.test.espresso:espresso-core:3.1.1'</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="auto-package-自动打包"><a href="#auto-package-自动打包" class="headerlink" title="auto-package 自动打包"></a>auto-package 自动打包</h3><p>更改编译输出路径，以及编译输出app名称，不同的gradle版本，api会有些许差异</p>
<p>Gradle4.10以前配置如下</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//gradle4.10以前</span></span><br><span class="line">  android.applicationVariants.all { variant -></span><br><span class="line">      variant.outputs.all { output -></span><br><span class="line">          <span class="keyword">if</span> (variant.buildType.name == <span class="string">'release'</span>) {</span><br><span class="line">              outputFileName = <span class="string">"${variant.applicationId}_${variant.buildType.name}_${variant.versionName}.apk"</span></span><br><span class="line">              <span class="keyword">if</span> (outputFileName != <span class="literal">null</span> && outputFileName.endsWith(<span class="string">'.apk'</span>)) {</span><br><span class="line">                  variant.getPackageApplication().outputDirectory = <span class="keyword">new</span> File(<span class="string">"$rootProject.projectDir/out/${project.name}/"</span>+</span><br><span class="line">                          <span class="string">"${variant.flavorName}"</span>)</span><br><span class="line">                  variant.getPackageApplication().outputScope.apkDatas.forEach {</span><br><span class="line">                      apkData -> apkData.outputFileName = outputFileName</span><br><span class="line">                  }</span><br><span class="line">              }</span><br><span class="line">          }</span><br><span class="line">      }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure></div>

<p>Gradle4.10以后配置如下</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//gradle4.10以后</span></span><br><span class="line">android.applicationVariants.all { variant -></span><br><span class="line">    variant.outputs.each { output -></span><br><span class="line">        <span class="keyword">if</span> (variant.buildType.name == <span class="string">'release'</span>) {</span><br><span class="line">            <span class="keyword">def</span> outputFileName = <span class="string">"${variant.applicationId}."</span> +</span><br><span class="line">                    <span class="string">"${variant.flavorName}.${variant.buildType.name}.${variant.versionName}.apk"</span></span><br><span class="line">            output.outputFileName = outputFileName</span><br><span class="line">            <span class="keyword">def</span> outputDir = <span class="keyword">new</span> File(<span class="string">"$rootProject.projectDir/out/${project.name}/"</span> +</span><br><span class="line">                    <span class="string">"${variant.flavorName}"</span>)</span><br><span class="line">            variant.packageApplicationProvider.get().outputDirectory = <span class="keyword">new</span> File(<span class="string">"$outputDir"</span>)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>如果多应用工程，需要统一输出目录，可以编译完成后copy到统一的目录下，并记录版本信息</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line">android.applicationVariants.all { variant -></span><br><span class="line">	  <span class="comment">//重命名+重定义输出目录</span></span><br><span class="line">    variant.outputs.each { output -></span><br><span class="line">        <span class="keyword">if</span> (variant.buildType.name == <span class="string">'release'</span>) {</span><br><span class="line">            <span class="keyword">def</span> outputFileName = <span class="string">"${variant.applicationId}."</span> +</span><br><span class="line">                    <span class="string">"${variant.buildType.name}.${variant.versionName}.apk"</span></span><br><span class="line">            output.outputFileName = outputFileName</span><br><span class="line">            <span class="keyword">def</span> outputDir = <span class="keyword">new</span> File(<span class="string">"$rootProject.projectDir/out/${project.name}/"</span> +</span><br><span class="line">                    <span class="string">"${variant.flavorName}"</span>)</span><br><span class="line">            variant.packageApplicationProvider.get().outputDirectory = <span class="keyword">new</span> File(<span class="string">"$outputDir"</span>)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">		<span class="comment">//编译完成后，重新copy</span></span><br><span class="line">    variant.assemble.doLast {</span><br><span class="line">        variant.outputs.each { output -></span><br><span class="line">            <span class="keyword">def</span> outputFile = output.outputFile;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (outputFile != <span class="literal">null</span> && outputFile.name.endsWith(<span class="string">'.apk'</span>) && variant.buildType.name == <span class="string">'release'</span>) {</span><br><span class="line">                packageAppRelease(outputFile,variant)</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//重新copy 并写入文件</span></span><br><span class="line"><span class="keyword">def</span> packageAppRelease(outputFile, variant) {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> releaseDir = <span class="string">"$rootProject.projectDir/out/release/app/$getDateYYMMDD"</span></span><br><span class="line">    <span class="keyword">def</span> newName = variant.applicationId + <span class="string">'.apk'</span></span><br><span class="line"></span><br><span class="line">    copyFile(<span class="string">"$outputFile"</span>, releaseDir</span><br><span class="line">            , <span class="string">"$outputFile.name"</span>, newName)</span><br><span class="line"></span><br><span class="line">    StringBuilder stringBuild = <span class="keyword">new</span> StringBuilder()</span><br><span class="line">    stringBuild.</span><br><span class="line">            append(<span class="string">"****************************************************"</span>).append(<span class="string">'\n'</span>)</span><br><span class="line">            .append(<span class="string">"*************** https://lairdli.top ***************"</span>).append(<span class="string">'\n'</span>)</span><br><span class="line">            .append(<span class="string">"****************************************************"</span>).append(<span class="string">'\n'</span>)</span><br><span class="line">            .append(<span class="string">"**:Name:"</span> + outputFile.name).append(<span class="string">'\n'</span>)</span><br><span class="line">            .append(<span class="string">"**:ApplicationId:"</span> + variant.applicationId).append(<span class="string">'\n'</span>)</span><br><span class="line">            .append(<span class="string">"**:VersionCode:"</span> + variant.versionCode).append(<span class="string">'\n'</span>)</span><br><span class="line">            .append(<span class="string">"**:VeresionName:"</span> + variant.versionName).append(<span class="string">'\n'</span>)</span><br><span class="line">            .append(<span class="string">"**:LastModify:"</span> + formatDateYYMMDDHMS(outputFile.lastModified())).append(<span class="string">'\n'</span>)</span><br><span class="line">            .append(<span class="string">"**:Size:"</span> + outputFile.length()).append(<span class="string">'\n'</span>)</span><br><span class="line">            .append(<span class="string">"**:Md5:"</span> + getFileMd5(outputFile)).append(<span class="string">'\n'</span>)</span><br><span class="line">            .append(<span class="string">"**:Sha1:"</span> + getFileSha1(outputFile)).append(<span class="string">'\n'</span>)</span><br><span class="line">            .append(<span class="string">"**:Des:"</span>).append(<span class="string">'\n'</span>)</span><br><span class="line">            .append(<span class="string">"****************************************************"</span>)</span><br><span class="line">            .append(<span class="string">'\n'</span>).append(<span class="string">'\n'</span>).append(<span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">    println stringBuild.toString()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> releaseModuleFileFullPath =  outputFile.getParent()+ File.separator + variant.applicationId + <span class="string">'.txt'</span>;</span><br><span class="line">    <span class="keyword">def</span> releasePackFileFullPath =releaseDir  +  File.separator + variant.applicationId + <span class="string">'.txt'</span>;</span><br><span class="line"></span><br><span class="line">    writeFile(releaseModuleFileFullPath, stringBuild.toString(), <span class="literal">true</span>)</span><br><span class="line">    writeFile(releasePackFileFullPath, stringBuild.toString(), <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> newName;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> writeFile(String fileName,String content,<span class="keyword">boolean</span> appendMode){</span><br><span class="line"></span><br><span class="line">    File file = <span class="keyword">new</span> File(fileName)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!file.exists()){</span><br><span class="line">        file.createNewFile();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(fileName, appendMode);</span><br><span class="line">    fos.write(content.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">    fos.close();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>写入配置文件内容如下</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">markdown</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>**</span><br><span class="line"><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span> https://lairdli.top <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span></span><br><span class="line"><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>**</span><br><span class="line">**:Name:top.lairdli.study.testapplication.release.201912291716.apk</span><br><span class="line">**:ApplicationId:top.lairdli.study.testapplication</span><br><span class="line">**:VersionCode:2019122916</span><br><span class="line">**:VeresionName:201912291716</span><br><span class="line">**:LastModify:2019-12-29 05:16:54</span><br><span class="line">**:Size:1439615</span><br><span class="line">**:Md5:f7ec01d7b6dced6b01fd11bf4c61aae4</span><br><span class="line">**:Sha1:dfd178102f4b8c2501bba6efae7ae11f58861f3a</span><br><span class="line">**:Des:</span><br><span class="line"><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>**</span><br></pre></td></tr></tbody></table></figure></div>

<p>编译生成的out目录结构如下</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Laird-MacBook-Pro:AndroidGradle laird$ cd out/</span><br><span class="line">Laird-MacBook-Pro:out laird$ tree</span><br><span class="line">.</span><br><span class="line">├── app_test</span><br><span class="line">│   ├── output.json</span><br><span class="line">│   ├── top.lairdli.study.testapplication1.release.201912291724.apk</span><br><span class="line">│   └── top.lairdli.study.testapplication1.txt</span><br><span class="line">├── app_test1</span><br><span class="line">│   ├── output.json</span><br><span class="line">│   ├── top.lairdli.study.testapplication1.release.201912291728.apk</span><br><span class="line">│   └── top.lairdli.study.testapplication1.txt</span><br><span class="line">└── release</span><br><span class="line">    └── app</span><br><span class="line">        └── 20191229</span><br><span class="line">            ├── top.lairdli.study.testapplication1.apk</span><br><span class="line">            └── top.lairdli.study.testapplication1.txt</span><br><span class="line"></span><br><span class="line">5 directories, 8 files</span><br><span class="line">Laird-MacBook-Pro:out laird$</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="key-store-秘钥配置"><a href="#key-store-秘钥配置" class="headerlink" title="key-store 秘钥配置"></a>key-store 秘钥配置</h3><p>普通签名keystore生成可以通过keytool生成秘钥。</p>
<p>系统签名keystore生成可以通过keytool-importkeypair 生成秘钥。</p>
<p>由于篇幅有限，本文只展示普通秘钥生成，更多使用命令行可参考往期博文</p>
<p><a href="https://lairdli.top/2019/08/13/android-command/">https://lairdli.top/2019/08/13/android-command/</a></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">To update your account to use zsh, please run `chsh -s /bin/zsh`.</span><br><span class="line">For more details, please visit https://support.apple.com/kb/HT208050.</span><br><span class="line">Laird-MacBook-Pro:~ laird$ keytool -genkey -alias test -keypass 123456 -keyalg RSA -keysize 2048 -validity 36500 -keystore test.keystore -storepass 123456</span><br><span class="line">您的名字与姓氏是什么?</span><br><span class="line">  [Unknown]:  lairdli.top</span><br><span class="line">您的组织单位名称是什么?</span><br><span class="line">  [Unknown]:  lairdli.top</span><br><span class="line">您的组织名称是什么?</span><br><span class="line">  [Unknown]:  lairdli.top</span><br><span class="line">您所在的城市或区域名称是什么?</span><br><span class="line">  [Unknown]:  wuhan</span><br><span class="line">您所在的省/市/自治区名称是什么?</span><br><span class="line">  [Unknown]:  hubei</span><br><span class="line">该单位的双字母国家/地区代码是什么?</span><br><span class="line">  [Unknown]:  china</span><br><span class="line">CN=lairdli.top, OU=lairdli.top, O=lairdli.top, L=wuhan, ST=hubei, C=china是否正确?</span><br><span class="line">  [否]:  y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Warning:</span><br><span class="line">JKS 密钥库使用专用格式。建议使用 "keytool -importkeystore -srckeystore test.keystore -destkeystore test.keystore -deststoretype pkcs12" 迁移到行业标准格式 PKCS12。</span><br><span class="line">Laird-MacBook-Pro:~ laird$</span><br></pre></td></tr></tbody></table></figure></div>

<p>除此之外AS-Build —>> Generate Signed APK–>Create New也可以创建秘钥。</p>
<p>As-app-build.gradle配置</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">signingConfigs {</span><br><span class="line">    release {</span><br><span class="line">        keyAlias <span class="string">'test'</span></span><br><span class="line">        keyPassword <span class="string">'123456'</span></span><br><span class="line">        storeFile file(<span class="string">"${rootProject.ext.defaultKeyStoreDir}"</span> + <span class="string">'/test.keystore'</span>)</span><br><span class="line">        storePassword <span class="string">'123456'</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    debug {</span><br><span class="line">        keyAlias <span class="string">'test'</span></span><br><span class="line">        keyPassword <span class="string">'123456'</span></span><br><span class="line">        storeFile file(<span class="string">"${rootProject.ext.defaultKeyStoreDir}"</span> + <span class="string">'/test.keystore'</span>)</span><br><span class="line">        storePassword <span class="string">'123456'</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">buildTypes {</span><br><span class="line"></span><br><span class="line">    debug {</span><br><span class="line">        signingConfig signingConfigs.debug</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    release {</span><br><span class="line">        minifyEnabled <span class="literal">false</span></span><br><span class="line">        proguardFiles getDefaultProguardFile(<span class="string">'proguard-android-optimize.txt'</span>), <span class="string">'proguard-rules.pro'</span></span><br><span class="line">        signingConfig signingConfigs.release</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>当然，如果不希望秘钥明文被看到，也可以将秘钥密匙配置在local.properties本地键值对中。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">properties</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#defined kesotre</span></span><br><span class="line"><span class="attr">SIGNINGCONFIGS_KEYALIAS</span>=<span class="string">test</span></span><br><span class="line"><span class="attr">SIGNINGCONFIGS_KEYPASSWORD</span>=<span class="string">123456</span></span><br><span class="line"><span class="attr">SIGNINGCONFIGS_STOREFILE</span>=<span class="string">/config/keystore/test.keystore</span></span><br><span class="line"><span class="attr">SIGNINGCONFIGS_STOREPASSWORD</span>=<span class="string">123456</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>然后在app-build.gradle中配置</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">signingConfigs {</span><br><span class="line">    ...</span><br><span class="line">    test{</span><br><span class="line">        keyAlias SIGNINGCONFIGS_KEYALIAS</span><br><span class="line">        keyPassword SIGNINGCONFIGS_KEYPASSWORD</span><br><span class="line">        storeFile file(SIGNINGCONFIGS_STOREFILE)</span><br><span class="line">        storePassword SIGNINGCONFIGS_STOREPASSWORD</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="module-config-模块化配置"><a href="#module-config-模块化配置" class="headerlink" title="module-config 模块化配置"></a>module-config 模块化配置</h3><p>之所以提出模块化编译，是为了按我们跟方便，更解耦的进行项目的编译开发工作。一切为了更好的Dev。</p>
<p>AndroidStudio模块化配置，可以从以下几个方面进行配置</p>
<blockquote>
<ul>
<li>setting.gradle 模块化配置，主要配置</li>
<li>build.gradle 模块化配置</li>
<li>utils.gradle 工具类配置</li>
</ul>
</blockquote>
<p>为更方便的管理，建议将utils.gradle工具类相关的脚步整理为单独的文件夹</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">config</span><br><span class="line">├── app.gradle</span><br><span class="line">├── config.gradle</span><br><span class="line">├── cvs.gradle</span><br><span class="line">├── keystore</span><br><span class="line">│   └── test.keystore</span><br><span class="line">├── lib.gradle</span><br><span class="line">├── libdebug.gradle</span><br><span class="line">├── sh</span><br><span class="line">│   ├── buildAll.sh</span><br><span class="line">│   └── cleanAll.sh</span><br><span class="line">└── util.gradle</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="setting-gradle-模块化配置"><a href="#setting-gradle-模块化配置" class="headerlink" title="setting.gradle 模块化配置"></a>setting.gradle 模块化配置</h4><p>对于多模块的Android项目，或者模块路径不在同级目录下的模块，自定义setting.gradle，非常有用。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">rootProject.name = <span class="string">'AndroidGradleTest'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * u can disable module by adding excludexxx properties in local.properties</span></span><br><span class="line"><span class="comment"> * the full excludexxx like below example:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> exclude_app_test=true</span></span><br><span class="line"><span class="comment"> exclude_app_test1=true</span></span><br><span class="line"><span class="comment"> exclude_lib_test=true</span></span><br><span class="line"><span class="comment"> exclude_lib_test1=true</span></span><br><span class="line"><span class="comment"> * u can copy the example ,and modify in u local.properties</span></span><br><span class="line"><span class="comment"> * focus!!!! local.properties should not be pushed to svn or git server.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">println <span class="string">"\n======================================================"</span></span><br><span class="line">println <span class="string">"**********  Init All Module ********** "</span></span><br><span class="line">println <span class="string">"**** compile gradle verison:"</span> + gradle.gradleVersion + <span class="string">"  ***** "</span></span><br><span class="line">println <span class="string">"======================================================\n"</span></span><br><span class="line"><span class="keyword">def</span> enableModuleMap = [</span><br><span class="line">        <span class="string">app_test :</span> <span class="literal">true</span>,</span><br><span class="line"><span class="symbol">        app_test1:</span> <span class="literal">true</span>,</span><br><span class="line">        <span class="string">lib_test :</span> <span class="literal">true</span>,</span><br><span class="line"><span class="symbol">        lib_test1:</span> <span class="literal">true</span></span><br><span class="line">]</span><br><span class="line">println <span class="string">"**** read enableModuleMap from local.properties"</span></span><br><span class="line">Properties properties = <span class="keyword">new</span> Properties()</span><br><span class="line">File propertyFile = <span class="keyword">new</span> File(rootDir.getAbsolutePath() + <span class="string">"/local.properties"</span>)</span><br><span class="line"><span class="keyword">if</span> (propertyFile.exists()) {</span><br><span class="line">    properties.load(propertyFile.newDataInputStream())</span><br><span class="line">    enableModuleMap.each {</span><br><span class="line">        entry -></span><br><span class="line">            entry.value = !Boolean.parseBoolean(properties.getProperty(<span class="string">'exclude_'</span> + entry.key))</span><br><span class="line">            println <span class="string">"enableModuleMap->module  "</span> + entry.key + <span class="string">" is included : "</span> + entry.value</span><br><span class="line">    }</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">    println <span class="string">"**** ${propertyFile.getAbsolutePath()} is not exists! "</span></span><br><span class="line">}</span><br><span class="line">println <span class="string">"**** finish enableModuleMap from local.properties "</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * -----------------------application modules--------------------------</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (enableModuleMap.app_test) {</span><br><span class="line">    include <span class="string">'app_test'</span></span><br><span class="line">    project(<span class="string">':app_test'</span>).projectDir = <span class="keyword">new</span> File(<span class="string">'testapplication'</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (enableModuleMap.app_test1) {</span><br><span class="line">    include <span class="string">'app_test'</span></span><br><span class="line">    project(<span class="string">':app_test'</span>).projectDir = <span class="keyword">new</span> File(<span class="string">'testapplication1'</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * -----------------------library modules--------------------------</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">if</span> (enableModuleMap.lib_test) {</span><br><span class="line">    include <span class="string">'lib_test'</span></span><br><span class="line">    project(<span class="string">':lib_test'</span>).projectDir = <span class="keyword">new</span> File(<span class="string">'testlibrary'</span>)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (enableModuleMap.lib_test1) {</span><br><span class="line">    include <span class="string">'lib_test1'</span></span><br><span class="line">    project(<span class="string">':lib_test1'</span>).projectDir = <span class="keyword">new</span> File(<span class="string">'testlibrary1'</span>)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>当暂时不需要此模块加入工程编译时，只需在local.properties中配置要剔除的模块即可</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">properties</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## This file is automatically generated by Android Studio.</span></span><br><span class="line"><span class="comment"># Do not modify this file -- YOUR CHANGES WILL BE ERASED!</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This file should *NOT* be checked into Version Control Systems,</span></span><br><span class="line"><span class="comment"># as it contains information specific to your local configuration.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Location of the SDK. This is only used by Gradle.</span></span><br><span class="line"><span class="comment"># For customization when using a Version Control System, please read the</span></span><br><span class="line"><span class="comment"># header note.</span></span><br><span class="line"><span class="meta">sdk.dir</span>=<span class="string">/Users/laird/Soft/Android/sdk</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#exclude module from project</span></span><br><span class="line"><span class="attr">exclude_app_test</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#exclude_app_test1=true</span></span><br><span class="line"><span class="attr">exclude_lib_test</span>=<span class="string">true</span></span><br><span class="line"><span class="comment">#exclude_lib_test1=true</span></span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="build-gradle模块化配置"><a href="#build-gradle模块化配置" class="headerlink" title="build.gradle模块化配置"></a>build.gradle模块化配置</h4><h5 id="Project-build-gradle"><a href="#Project-build-gradle" class="headerlink" title="Project-build.gradle"></a>Project-build.gradle</h5><p>项目根目录下build.gradle配置，主要配置一些脚本依赖，</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span></span><br><span class="line"></span><br><span class="line">apply <span class="string">from:</span> rootProject.file(<span class="string">"config/util.gradle"</span>)</span><br><span class="line">apply <span class="string">from:</span> rootProject.file(<span class="string">"config/cvs.gradle"</span>)</span><br><span class="line">apply <span class="string">from:</span> rootProject.file(<span class="string">"config/config.gradle"</span>)</span><br></pre></td></tr></tbody></table></figure></div>

<ul>
<li><h6 id="util-gradle"><a href="#util-gradle" class="headerlink" title="util.gradle"></a>util.gradle</h6></li>
</ul>
<p>主要配置一些工具方法类</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.security.MessageDigest</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat</span><br><span class="line"></span><br><span class="line">ext{</span><br><span class="line">    getDateYYMMDD = <span class="keyword">this</span>.&getDateYYMMDD</span><br><span class="line">    formatDateYYMMDDHMS = <span class="keyword">this</span>.&formatDateYYMMDDHMS</span><br><span class="line">    getVersionCode = <span class="keyword">this</span>.&getVersionCode</span><br><span class="line">    getVersionName = <span class="keyword">this</span>.&getVersionName</span><br><span class="line">    copyFile = <span class="keyword">this</span>.©File</span><br><span class="line">    getFileSha1 = <span class="keyword">this</span>.&getFileSha1</span><br><span class="line">    getFileMd5 = <span class="keyword">this</span>.&getFileMd5</span><br><span class="line">    writeFile = <span class="keyword">this</span>.&writeFile</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> getDateYYMMDD(){</span><br><span class="line">    Integer.parseInt(<span class="keyword">new</span> Date().format(<span class="string">"yyyyMMdd"</span>))</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> formatDateYYMMDDHMS(time){</span><br><span class="line">    Calendar calendar = Calendar.getInstance()</span><br><span class="line">    calendar.setTimeInMillis(time)</span><br><span class="line">    Date date = calendar.getTime()</span><br><span class="line">    SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd hh:mm:ss"</span>);</span><br><span class="line">    sdf.format(date)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> getVersionCode() {</span><br><span class="line">    Integer.parseInt(<span class="keyword">new</span> Date().format(<span class="string">"yyyyMMddmm"</span>))</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> getVersionName() {</span><br><span class="line"></span><br><span class="line">    String today = <span class="keyword">new</span> Date().format(<span class="string">"yyyyMMdd"</span>)</span><br><span class="line">    String time =  <span class="keyword">new</span> Date().format(<span class="string">"HHmm"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(rootProject.ext.isNeedSvnVersion){</span><br><span class="line">        <span class="string">"$today"</span> + <span class="string">"$time"</span>+<span class="string">".$rootProject.ext.buildSvnNum"</span></span><br><span class="line">    }<span class="keyword">else</span>{</span><br><span class="line">        <span class="string">"$today"</span> + <span class="string">"$time"</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> copyFile(String fromFile, String dstDir,String oldName, String newName){</span><br><span class="line">    copy {</span><br><span class="line">        from fromFile</span><br><span class="line">        into dstDir</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(oldName!=<span class="literal">null</span> && newName!=<span class="literal">null</span>){</span><br><span class="line">            rename(oldName, newName)</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> getFileSha1(file)</span><br><span class="line">{</span><br><span class="line">    MessageDigest md = MessageDigest.getInstance(<span class="string">"SHA-1"</span>);</span><br><span class="line">    file.eachByte <span class="number">4096</span>, {bytes, size -></span><br><span class="line">        md.update(bytes, <span class="number">0</span>, size);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> md.digest().collect {String.format <span class="string">"%02x"</span>, it}.join();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> getFileMd5(file)</span><br><span class="line">{</span><br><span class="line">    MessageDigest md = MessageDigest.getInstance(<span class="string">"MD5"</span>);</span><br><span class="line">    file.eachByte <span class="number">4096</span>, {bytes, size -></span><br><span class="line">        md.update(bytes, <span class="number">0</span>, size);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> md.digest().collect {String.format <span class="string">"%02x"</span>, it}.join();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> writeFile(String fileName,String content,<span class="keyword">boolean</span> appendMode){</span><br><span class="line"></span><br><span class="line">    File file = <span class="keyword">new</span> File(fileName)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!file.exists()){</span><br><span class="line">        file.createNewFile();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(fileName, appendMode);</span><br><span class="line">    fos.write(content.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">    fos.close();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<ul>
<li><h6 id="cvs-gradle"><a href="#cvs-gradle" class="headerlink" title="cvs.gradle"></a>cvs.gradle</h6></li>
</ul>
<p>主要配置一些版本相关工具类</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.tmatesoft.svn.core.wc.ISVNOptions</span><br><span class="line"><span class="keyword">import</span> org.tmatesoft.svn.core.wc.SVNClientManager</span><br><span class="line"><span class="keyword">import</span> org.tmatesoft.svn.core.wc.SVNRevision</span><br><span class="line"><span class="keyword">import</span> org.tmatesoft.svn.core.wc.SVNStatus</span><br><span class="line"><span class="keyword">import</span> org.tmatesoft.svn.core.wc.SVNStatusClient</span><br><span class="line"><span class="keyword">import</span> org.tmatesoft.svn.core.wc.SVNWCUtil</span><br><span class="line"></span><br><span class="line">buildscript {</span><br><span class="line">    repositories {</span><br><span class="line">        maven{ url <span class="string">'http://maven.aliyun.com/nexus/content/groups/public/'</span>}</span><br><span class="line">    }</span><br><span class="line">    dependencies {</span><br><span class="line">        classpath <span class="string">'org.tmatesoft.svnkit:svnkit:1.10.1'</span></span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">ext{</span><br><span class="line">    buildSvnNum = <span class="keyword">this</span>.&buildSvnNo</span><br><span class="line">    buildGitNum = <span class="keyword">this</span>.&buildGitNo</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> buildSvnNo() {</span><br><span class="line">  </span><br><span class="line">    ISVNOptions options = SVNWCUtil.createDefaultOptions(<span class="literal">true</span>);</span><br><span class="line">    SVNClientManager clientManager = SVNClientManager.newInstance(options);</span><br><span class="line">    SVNStatusClient statusClient = clientManager.getStatusClient();</span><br><span class="line">    SVNStatus status = statusClient.doStatus(projectDir, <span class="literal">false</span>);</span><br><span class="line">    SVNRevision revision = status.getRevision();</span><br><span class="line">    <span class="keyword">def</span> svnLog = revision.getNumber();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">def</span> buildGitNo() {</span><br><span class="line">    String revisionNumberCMD = <span class="string">'git rev-parse --short HEAD'</span></span><br><span class="line">    revisionNumberCMD.execute().getText().trim()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<ul>
<li><h6 id="config-gradle"><a href="#config-gradle" class="headerlink" title="config.gradle"></a>config.gradle</h6></li>
</ul>
<p>主要配置一些全局变量，版本号统一等</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">ext {</span><br><span class="line">    <span class="comment">//true 每个业务Module可以单独开发</span></span><br><span class="line">    <span class="comment">//false 每个业务Module以lib的方式运行</span></span><br><span class="line">    <span class="comment">//修改之后需要Sync方可生效</span></span><br><span class="line">    isBuildModule = <span class="literal">false</span></span><br><span class="line">    <span class="comment">//是否需要代码混淆</span></span><br><span class="line">    isNeedMinify = <span class="literal">false</span></span><br><span class="line">    <span class="comment">//是否需要打开git版本</span></span><br><span class="line">    isNeedSvnVersion = <span class="literal">false</span></span><br><span class="line">    <span class="comment">//是否需要打开git版本</span></span><br><span class="line">    isNeedGitVersion = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    defaultKeyStoreDir = rootProject.file(<span class="string">"config/keystore"</span>)</span><br><span class="line">		<span class="comment">//模块相关的属性</span></span><br><span class="line">    modules = [</span><br><span class="line">            <span class="string">utilcommon_dir :</span> rootProject.file(<span class="string">"../xxx"</span>)   ,</span><br><span class="line">            <span class="string">uiservice_dir :</span> rootProject.file(<span class="string">"../xxxx"</span>)</span><br><span class="line">    ]</span><br><span class="line">		<span class="comment">//android编译相关的版本号</span></span><br><span class="line">    androids = [</span><br><span class="line">            <span class="string">applicationId           :</span> <span class="string">"top.lairdli.app"</span>,     <span class="comment">//应用ID</span></span><br><span class="line">            <span class="string">versionCode             :</span> getVersionCode(),      <span class="comment">//版本号</span></span><br><span class="line">            <span class="string">versionName             :</span> getVersionName(),      <span class="comment">//版本名称</span></span><br><span class="line">            <span class="string">versionCodeDebug        :</span> <span class="number">8888888888</span>,      <span class="comment">//版本号</span></span><br><span class="line">            <span class="string">versionNameDebug        :</span> <span class="string">"DebugVersion"</span>,      <span class="comment">//版本名称</span></span><br><span class="line"></span><br><span class="line">            <span class="string">compileSdkVersion       :</span> <span class="number">28</span>,</span><br><span class="line">            <span class="string">minSdkVersion           :</span> <span class="number">15</span>,</span><br><span class="line">            <span class="string">buildToolsVersion       :</span> <span class="string">"29.0.2"</span>,</span><br><span class="line">            <span class="string">targetSdkVersion        :</span> <span class="number">22</span>,</span><br><span class="line"><span class="symbol">            androidSupportSdkVersion:</span> <span class="string">"28.0.0"</span>,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第三方库版本号</span></span><br><span class="line">    versions = [</span><br><span class="line"></span><br><span class="line">            <span class="string">xmaterialVersion        :</span> <span class="string">"1.0.0"</span>,</span><br><span class="line">            <span class="string">xrunnerVersion          :</span> <span class="string">"1.2.0"</span>,</span><br><span class="line">            <span class="string">xrolesVersion           :</span> <span class="string">"1.2.0"</span>,</span><br><span class="line">            ...</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">	 <span class="comment">//依赖配置</span></span><br><span class="line">    dependencies = [</span><br><span class="line">            <span class="string">"x_constraint_layout"</span>   : <span class="string">"androidx.constraintlayout:constraintlayout:${versions["</span>xconstraintLayoutVersion<span class="string">"]}"</span>,</span><br><span class="line">            <span class="string">"x_runner"</span>              : <span class="string">"androidx.test:runner:${versions["</span>xrunnerVersion<span class="string">"]}"</span>,</span><br><span class="line">            <span class="string">"x_rules"</span>               : <span class="string">"androidx.test:rules:${versions["</span>xrulesVersion<span class="string">"]}"</span>,</span><br><span class="line">				...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h5 id="modlue-app-build-gradle"><a href="#modlue-app-build-gradle" class="headerlink" title="modlue-app-build.gradle"></a>modlue-app-build.gradle</h5><p>应用模块模块化，可以将统一的配置抽离整理成app.gradle</p>
<ul>
<li><h6 id="app-gradle"><a href="#app-gradle" class="headerlink" title="app.gradle"></a>app.gradle</h6></li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">'com.android.application'</span></span><br><span class="line"></span><br><span class="line">android {</span><br><span class="line">    compileSdkVersion rootProject.ext.androids.compileSdkVersion</span><br><span class="line">    buildToolsVersion rootProject.ext.androids.buildToolsVersion</span><br><span class="line">    flavorDimensions <span class="string">"versionCode"</span></span><br><span class="line"></span><br><span class="line">    defaultConfig {</span><br><span class="line">        minSdkVersion rootProject.ext.androids.minSdkVersion</span><br><span class="line">        targetSdkVersion rootProject.ext.androids.targetSdkVersion</span><br><span class="line">        versionCode rootProject.ext.androids.versionCode</span><br><span class="line">        versionName rootProject.ext.androids.versionName</span><br><span class="line"></span><br><span class="line">        testInstrumentationRunner <span class="string">"androidx.test.runner.AndroidJUnitRunner"</span></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    signingConfigs {</span><br><span class="line">    	<span class="comment">//篇幅有限，参考as-key-store配置</span></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br><span class="line">	<span class="comment">//篇幅有限，参考as-auto-package配置</span></span><br><span class="line">android.applicationVariants.all { variant -></span><br><span class="line">		</span><br><span class="line">    <span class="comment">//gradle4.10以后自定义版本命令规则以及生成目录</span></span><br><span class="line">    variant.outputs.each { </span><br><span class="line">   		...</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//自定义版本备份路径以及版本描述</span></span><br><span class="line">    variant.assemble.doLast {</span><br><span class="line">     ...</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">dependencies {</span><br><span class="line"><span class="comment">//    implementation fileTree(dir: 'libs', include: ['*.jar'])</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>然后在模块下build.gradle引用app.gradle</p>
<ul>
<li><h6 id="build-gradle"><a href="#build-gradle" class="headerlink" title="build.gradle"></a>build.gradle</h6></li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//apply plugin: 'com.android.application'</span></span><br><span class="line">apply <span class="string">from:</span> rootProject.file(<span class="string">"config/app.gradle"</span>)</span><br><span class="line"></span><br><span class="line">dependencies {</span><br><span class="line">    implementation fileTree(<span class="string">dir:</span> <span class="string">'libs'</span>, <span class="string">include:</span> [<span class="string">'*.jar'</span>])</span><br><span class="line"></span><br><span class="line">    implementation rootProject.ext.dependencies[<span class="string">"x_appcompat"</span>]</span><br><span class="line">    implementation rootProject.ext.dependencies[<span class="string">"x_constraint_layout"</span>]</span><br><span class="line">    testImplementation rootProject.ext.dependencies[<span class="string">"junit"</span>]</span><br><span class="line">    androidTestImplementation rootProject.ext.dependencies[<span class="string">"runner"</span>]</span><br><span class="line">    androidTestImplementation rootProject.ext.dependencies[<span class="string">"espresso-core"</span>]</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h5 id="modlue-lib-build-gradle"><a href="#modlue-lib-build-gradle" class="headerlink" title="modlue-lib-build.gradle"></a>modlue-lib-build.gradle</h5><p>参考modlue-app-build.gradle配置，也可以抽离lib.gradle.</p>
<ul>
<li><h6 id="lib-gradle"><a href="#lib-gradle" class="headerlink" title="lib.gradle"></a>lib.gradle</h6></li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">'com.android.library'</span></span><br><span class="line"></span><br><span class="line">android {</span><br><span class="line">    compileSdkVersion rootProject.ext.androids.compileSdkVersion</span><br><span class="line">    buildToolsVersion rootProject.ext.androids.buildToolsVersion</span><br><span class="line"></span><br><span class="line">    defaultConfig {</span><br><span class="line">        minSdkVersion rootProject.ext.androids.minSdkVersion</span><br><span class="line">        targetSdkVersion rootProject.ext.androids.targetSdkVersion</span><br><span class="line">        versionCode rootProject.ext.androids.versionCode</span><br><span class="line">        versionName rootProject.ext.androids.versionName</span><br><span class="line"></span><br><span class="line">        testInstrumentationRunner <span class="string">"androidx.test.runner.AndroidJUnitRunner"</span></span><br><span class="line">        consumerProguardFiles <span class="string">'consumer-rules.pro'</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    buildTypes {</span><br><span class="line">        release {</span><br><span class="line">            minifyEnabled <span class="literal">false</span></span><br><span class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android-optimize.txt'</span>), <span class="string">'proguard-rules.pro'</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">android.libraryVariants.all { variant -></span><br><span class="line">    variant.assemble.doLast {</span><br><span class="line">        variant.outputs.each { output -></span><br><span class="line">            <span class="keyword">def</span> outputFile = output.outputFile;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (outputFile != <span class="literal">null</span> && outputFile.name.endsWith(<span class="string">'.aar'</span>) && variant.buildType.name == <span class="string">'release'</span>) {</span><br><span class="line">                copyFileToApk(outputFile,variant)</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> copyFileToApk(outputFile, variant) {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> newName = variant.applicationId + <span class="string">'.aar'</span>;</span><br><span class="line">    <span class="keyword">def</span> releaseDir = <span class="string">"$rootProject.projectDir/out/aar/app/$getDateYYMMDD"</span></span><br><span class="line"></span><br><span class="line">    copyFile(<span class="string">"$outputFile"</span>, releaseDir</span><br><span class="line">            , <span class="string">"$outputFile.name"</span>, <span class="string">"$newName"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> newName;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">dependencies {</span><br><span class="line"><span class="comment">//    implementation fileTree(dir: 'libs', include: ['*.jar'])</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>然后在library模块下的build.gradle目录下进行引用</p>
<ul>
<li><h6 id="build-gradle-1"><a href="#build-gradle-1" class="headerlink" title="build.gradle"></a>build.gradle</h6></li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">from:</span> rootProject.file(<span class="string">"config/lib.gradle"</span>)</span><br><span class="line"></span><br><span class="line">dependencies {</span><br><span class="line">    implementation fileTree(<span class="string">dir:</span> <span class="string">'libs'</span>, <span class="string">include:</span> [<span class="string">'*.jar'</span>])</span><br><span class="line"></span><br><span class="line">    implementation rootProject.ext.dependencies[<span class="string">"x_appcompat"</span>]</span><br><span class="line">    testImplementation rootProject.ext.dependencies[<span class="string">"junit"</span>]</span><br><span class="line">    androidTestImplementation rootProject.ext.dependencies[<span class="string">"runner"</span>]</span><br><span class="line">    androidTestImplementation rootProject.ext.dependencies[<span class="string">"espresso-core"</span>]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h5 id="Modlue-lib-debug-build-gradle"><a href="#Modlue-lib-debug-build-gradle" class="headerlink" title="Modlue-lib(debug)-build.gradle"></a>Modlue-lib(debug)-build.gradle</h5><p>其实这个模块还是属性lib模块，只是在模块化项目下，某些情况下我们只负责某一个库模块，这个时候，如果要进行调试，相对于application可以直接在as上run,lib模块可能会有些劣势了。那有没有办法在最小的改动下我们也可以让lib也能像app一样run起来了？</p>
<p>答案是肯定的，只需一处改动就能实现。还记得config.gradle-ext里面有一个熟悉吗？</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ext {</span><br><span class="line">    //true 每个业务Module可以单独开发</span><br><span class="line">    //false 每个业务Module以lib的方式运行</span><br><span class="line">    //修改之后需要Sync方可生效</span><br><span class="line">    isBuildModule = false</span><br><span class="line">    ...</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure></div>

<p>对就是这个isBuildModule属性，当我们想让lib变成app时，只需将isBuildModule改为true然后同步下工程即可</p>
<p>so，怎么实现咧？</p>
<p>还是想上文lib.gradle配置一样，我们也可以重新配置一个libdebug.gradle.下文主要列出一些不同点。</p>
<ul>
<li><h6 id="libdebug-gradle"><a href="#libdebug-gradle" class="headerlink" title="libdebug.gradle"></a>libdebug.gradle</h6></li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Boolean.valueOf(rootProject.ext.isBuildModule)) {</span><br><span class="line">    apply <span class="string">plugin:</span> <span class="string">'com.android.application'</span></span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">    apply <span class="string">plugin:</span> <span class="string">'com.android.library'</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">android {</span><br><span class="line">    ...</span><br><span class="line">    sourceSets {</span><br><span class="line">        main {</span><br><span class="line">            jniLibs.srcDirs = [<span class="string">'libs'</span>]</span><br><span class="line"></span><br><span class="line">            <span class="comment">//如果是lib-app isBuildModule模式，走manifest目录下的AndroidManifest</span></span><br><span class="line">            <span class="keyword">if</span> (Boolean.valueOf(rootProject.ext.isBuildModule)) {</span><br><span class="line">                manifest.srcFile <span class="string">'src/main/manifest/AndroidManifest.xml'</span></span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                manifest.srcFile <span class="string">'src/main/AndroidManifest.xml'</span></span><br><span class="line">                java {</span><br><span class="line">                    <span class="comment">//lib model ,exclude all file below java/debug/</span></span><br><span class="line">                    exclude <span class="string">'*modlue'</span></span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"><span class="comment">//自定义版本命令规则，生成路径等</span></span><br><span class="line"><span class="keyword">if</span> (Boolean.valueOf(rootProject.ext.isBuildModule)) {</span><br><span class="line">    android.applicationVariants.all { variant -></span><br><span class="line">     ...</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">    android.libraryVariants.all { variant -></span><br><span class="line">     ...</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>然后在待调试的lib中build.gradle配置</p>
<ul>
<li><h6 id="build-gradle-2"><a href="#build-gradle-2" class="headerlink" title="build.gradle"></a>build.gradle</h6></li>
</ul>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apply from: rootProject.file("config/libdebug.gradle")</span><br><span class="line"></span><br><span class="line">dependencies {</span><br><span class="line">    implementation fileTree(dir: 'libs', include: ['*.jar'])</span><br><span class="line"></span><br><span class="line">    if (Boolean.valueOf(rootProject.ext.isBuildModule)) {</span><br><span class="line">        implementation rootProject.ext.dependencies["x_constraint_layout"]</span><br><span class="line">    }</span><br><span class="line">    implementation rootProject.ext.dependencies["x_appcompat"]</span><br><span class="line">    testImplementation rootProject.ext.dependencies["junit"]</span><br><span class="line">    androidTestImplementation rootProject.ext.dependencies["runner"]</span><br><span class="line">    androidTestImplementation rootProject.ext.dependencies["espresso-core"]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>这样你的library模块就可以向application一样飞一般的run了。</p>
<p>but还是有些问题，如果子模块有重写application逻辑，或者项目中用了类似ARouter的工具结构，那又改怎么配置咧？不急，一步一步来。</p>
<ul>
<li><h6 id="aRouter"><a href="#aRouter" class="headerlink" title="aRouter"></a>aRouter</h6></li>
</ul>
<p>配置aRouter引用,模块build.gradle进行配置</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">android {</span><br><span class="line">  </span><br><span class="line">     javaCompileOptions {</span><br><span class="line">        annotationProcessorOptions {</span><br><span class="line">            arguments = [<span class="string">AROUTER_MODULE_NAME:</span> project.getName()]</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">dependencies {</span><br><span class="line">    implementation rootProject.ext.dependencies[<span class="string">"arouter"</span>]</span><br><span class="line">    annotationProcessor rootProject.ext.dependencies[<span class="string">"arouter-compiler"</span>]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>MainActivity统一拦截url或intent进行分发处理</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onNewIntent</span><span class="params">(Intent intent)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onNewIntent(intent);</span><br><span class="line">        handleIntent(intent);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handleIntent</span><span class="params">(Intent intent)</span> </span>{</span><br><span class="line">        ARouterHelper.getInstance().dispatchPage(intent);</span><br><span class="line">        finish();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>Arouter调用时我们也可以封装一个工具类进行路由分发等</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> laird</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019-12-30 11:09</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desc</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ARouterHelper</span> </span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PATH_ACTIVITY_LIB_TEST = <span class="string">"/ModuleLib/LibActivity"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACTION_ACTIVITY_LIB_TEST = <span class="string">"top.lairdli.action.LIB_TEST"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ARouterHelper <span class="title">getInstance</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span> </span>{</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ARouterHelper INSTANCE = <span class="keyword">new</span> ARouterHelper();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(String path)</span></span>{</span><br><span class="line">        ARouter.getInstance().build(path).navigation();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(String path, Activity activity, <span class="keyword">int</span> requestCode)</span></span>{</span><br><span class="line">        ARouter.getInstance().build(path).navigation(activity,requestCode);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(String path,String key,String value)</span></span>{</span><br><span class="line">        ARouter.getInstance().build(path).withString(key,value).navigation();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Postcard <span class="title">getPostCard</span><span class="params">(String path)</span></span>{</span><br><span class="line">        <span class="keyword">return</span> ARouter.getInstance().build(path);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//fix me</span></span><br><span class="line">    <span class="comment">// 1. intent can be replaced by schame-url</span></span><br><span class="line">    <span class="comment">// 2. withSerializable can be replaced by with object,but u should implement SerializationService First</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispatchPage</span><span class="params">(Intent intent)</span> </span>{</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (intent == <span class="keyword">null</span> || intent.getAction() == <span class="keyword">null</span>) {</span><br><span class="line">            dispatchPageDefault();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (intent.getAction()) {</span><br><span class="line">            <span class="keyword">case</span> ACTION_ACTIVITY_LIB_TEST:</span><br><span class="line">                build(PATH_ACTIVITY_LIB_TEST);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                dispatchPageDefault();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">dispatchPageDefault</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// to add u default page</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>更多使用方法可以参靠<a href="https://github.com/alibaba/ARouter/blob/master/README_CN.md" target="_blank" rel="noopener">Arouter官方说明</a></p>
<ul>
<li><h6 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h6></li>
</ul>
<p>lib向app转换时，另外一个问题就是Application逻辑的问题，当主APP包含Lib模块时，我们也希望Lib中的逻辑也能被执行，但manifest却只能配置一个application-name.配置了主App的application后，lib就不能配置了。</p>
<p>本着尽量解耦，最少改动的原则，我们还是用面向接口编程的实现，先看如下类图，看完你就明白了。</p>
<p><a href="https://s1.ax1x.com/2020/05/18/YWsWtg.md.png" target="_blank" rel="noopener" data-fancybox="group" data-caption="AsMulModules" class="fancybox"><img alt="AsMulModules" data-src="https://s1.ax1x.com/2020/05/18/YWsWtg.md.png" class="lazyload" title="AsMulModules"></a></p>
<p>Main-appliaction</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainApplication</span> <span class="keyword">extends</span> <span class="title">BaseApplication</span> <span class="keyword">implements</span> <span class="title">IAppApplication</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] MODULESLIST =</span><br><span class="line">            {<span class="string">"top.lairdli.study.testlibrary.LibApplication"</span>};</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List<string> <span class="title">getModuleAppClassList</span><span class="params">()</span> </string></span>{</span><br><span class="line">        <span class="keyword">return</span> Arrays.asList(MODULESLIST);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Application instance)</span> </span>{</span><br><span class="line">        Log.d(LOG_TAG, <span class="string">"---init"</span>);</span><br><span class="line">      	<span class="comment">//to do u biz</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>Libdebug-application</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LibApplication</span> <span class="keyword">extends</span> <span class="title">BaseApplication</span> </span>{</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Application instance)</span> </span>{</span><br><span class="line">        Log.d(LOG_TAG,<span class="string">"---init"</span>);</span><br><span class="line">        <span class="comment">//to do u biz</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>BaseApplication</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: BaseApplication</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressLint</span>(<span class="string">"Registered"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> <span class="keyword">implements</span> <span class="title">IComponentApplication</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> String LOG_TAG = <span class="string">"BaseApplication"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> BaseApplication instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">static</span> BaseApplication <span class="title">getInstance</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List<activity> mList = <span class="keyword">new</span> LinkedList<activity>();</activity></activity></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseApplication</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        LOG_TAG = <span class="keyword">this</span>.getClass().getSimpleName();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>{</span><br><span class="line">        Log.v(LOG_TAG, <span class="string">"onCreate()"</span>);</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        <span class="comment">//init ARouter</span></span><br><span class="line">        <span class="keyword">if</span>(BuildConfig.DEBUG){</span><br><span class="line">            ARouter.openLog();</span><br><span class="line">            ARouter.openDebug();</span><br><span class="line">        }</span><br><span class="line">        ARouter.init(<span class="keyword">this</span>);</span><br><span class="line">        instance= <span class="keyword">this</span>;</span><br><span class="line">        <span class="comment">//asbs method ,implementation in sub class</span></span><br><span class="line">        init(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">//init call modulesApplication</span></span><br><span class="line">        <span class="keyword">if</span> (IAppApplication.class.isAssignableFrom(<span class="keyword">this</span>.getClass())) {</span><br><span class="line">            IAppApplication appApplication = (IAppApplication) <span class="keyword">this</span>;</span><br><span class="line">            modulesApplicationInit(appApplication.getModuleAppClassList());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">modulesApplicationInit</span><span class="params">(List<string> modulesList)</string></span></span>{</span><br><span class="line">        <span class="keyword">for</span> (String moduleImpl : modulesList){</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Class<!--?--> clazz = Class.forName(moduleImpl);</span><br><span class="line">                Object obj = clazz.newInstance();</span><br><span class="line">                <span class="keyword">if</span> (obj <span class="keyword">instanceof</span> IComponentApplication){</span><br><span class="line">                    ((IComponentApplication) obj).init(BaseApplication.getInstance());</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">catch</span> (ClassNotFoundException | IllegalAccessException | InstantiationException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure></div>

<p>IApplication</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IAppApplication</span> </span>{</span><br><span class="line">    <span class="function">List<string> <span class="title">getModuleAppClassList</span><span class="params">()</span></string></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>IComponentApplication</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IComponentApplication</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(Application instance)</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>MainApplication编译时运行打印如下</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2019-12-30 11:43:39.219 23539-23539/? D/MainApplication: ---init</span><br><span class="line">2019-12-30 11:43:39.219 23539-23539/? D/LibApplication: ---init</span><br></pre></td></tr></tbody></table></figure></div>

<p>Libdebug-application当模块编译时运行打印如下</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2019-12-30 11:43:39.219 23539-23539/? D/LibApplication: ---init</span><br></pre></td></tr></tbody></table></figure></div>

<p>以上是我总结的一种解决模块化Application问题的方法之一，如果还有其他更好的方法也欢迎补充。</p>
<h3 id="eclipse-translate-旧工程迁移"><a href="#eclipse-translate-旧工程迁移" class="headerlink" title="eclipse-translate 旧工程迁移"></a>eclipse-translate 旧工程迁移</h3><p>对于以前eclipse旧工程，如果我们不希望破坏之前原有路径或者代码结构，但又想再忍受eclipse的IED，想再AS上进行调试，只需3个步骤三部曲就行</p>
<h4 id="1-脚本拷贝"><a href="#1-脚本拷贝" class="headerlink" title="1. 脚本拷贝"></a>1. 脚本拷贝</h4><p>新建as工程文件夹，拷贝正常as项目文件配置到步骤1所建立的文件夹</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">shell</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r--   1 laird  staff   713 12 29 16:05 build.gradle</span><br><span class="line">drwxr-xr-x   3 laird  staff    96 12 29 14:42 gradle/</span><br><span class="line">-rw-r--r--   1 laird  staff  1073 12 29 15:20 gradle.properties</span><br><span class="line">-rwxr--r--   1 laird  staff  5296 12 29 14:42 gradlew*</span><br><span class="line">-rw-r--r--   1 laird  staff  2260 12 29 14:42 gradlew.bat</span><br><span class="line">-rw-r--r--   1 laird  staff  2079 12 29 17:26 settings.gradle</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="2-项目配置"><a href="#2-项目配置" class="headerlink" title="2. 项目配置"></a>2. 项目配置</h4><p>配置项目setting.gradle，将需要转换的eclispe工程模块include到setting.gradle中。</p>
<p>可参考As-project-setting.gradle</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rootProject.name = <span class="string">'ProjectEclipse2As'</span></span><br><span class="line"></span><br><span class="line">include <span class="string">'app_module'</span></span><br><span class="line">project(<span class="string">':app_module'</span>).projectDir = <span class="keyword">new</span> File(<span class="string">'../u eclispe app moudle path)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">include '</span>lib_module<span class="string">'</span></span><br><span class="line"><span class="string">project('</span>:lib_vodservice<span class="string">').projectDir = new File('</span>..<span class="regexp">/../</span>u eclispe lib moudle path<span class="string">')</span></span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="3-配置模块build-gradle"><a href="#3-配置模块build-gradle" class="headerlink" title="3. 配置模块build.gradle"></a>3. 配置模块build.gradle</h4><p>模块build.gradle包含library,application两种，掌握了application的配置，library的配置对比着配就行了</p>
<p>建议直接copy一份完整的application-build.gradle，然后我们只需要改几个关键的点就行</p>
<ul>
<li><h5 id="源码路径"><a href="#源码路径" class="headerlink" title="源码路径"></a>源码路径</h5><p>由于as默认的源码构建方式和eclipse有些区别，因为第一个重要的点就是配置源码路径</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">java</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sourceSets {</span><br><span class="line">    main {</span><br><span class="line">        manifest.srcFile <span class="string">'manifest/AndroidManifest.xml'</span></span><br><span class="line">        java.srcDirs = [<span class="string">'src'</span>]</span><br><span class="line">        resources.srcDirs = [<span class="string">'src'</span>]</span><br><span class="line">        aidl.srcDirs = [<span class="string">'src'</span>]</span><br><span class="line">        renderscript.srcDirs = [<span class="string">'src'</span>]</span><br><span class="line">        res.srcDirs = [<span class="string">'res'</span>]</span><br><span class="line">        assets.srcDirs = [<span class="string">'assets'</span>]</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>需要注意的是manifest，由于最新版本的as对manifest的一些配置有强制限制（版本号相关），因而建议copy一份AndroidManifest.xml到manifest文件夹，重新制定路径。这样不影响之前elcipse工程配置。</p>
</li>
<li><h5 id="依赖配置"><a href="#依赖配置" class="headerlink" title="依赖配置"></a>依赖配置</h5><p>原eclipse工程依赖配置可在project.properties文件中查看，</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">properties</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">target</span>=<span class="string">android-17</span></span><br><span class="line"><span class="meta">proguard.config</span>=<span class="string">proguard.cfg</span></span><br><span class="line"><span class="meta">android.library.reference.1</span>=<span class="string">../../../library1</span></span><br><span class="line"><span class="meta">android.library.reference.2</span>=<span class="string">../../../library2</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>根据project.properties的配置在build.gradle中的depend中相应配置。</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dependencies {</span><br><span class="line">    implementation fileTree(<span class="string">dir:</span> <span class="string">'libs'</span>, <span class="string">include:</span> [<span class="string">'*.jar'</span>])</span><br><span class="line">    implementation project(<span class="string">':library1'</span>)</span><br><span class="line">    implementation project(<span class="string">':library2'</span>)</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure></div>

<p>需要注意的是除了模块间的依赖外，libs下的jar包，so依赖也许要注意。</p>
<p> jar包依赖分两种，一种编译时依赖，一种运行时依赖。</p>
<p>编译时依赖只参与编译，不打入app源码，一般是引用系统api会用到。</p>
<p>编译时依赖使用compileOnly</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compileOnly files(<span class="string">'libs/compileOnlyxxx.jar'</span>)</span><br></pre></td></tr></tbody></table></figure></div>

<p>运行时依赖除了参与编译，会打入app源码，常见的模块键依赖就是这种。</p>
<p>运行时依赖使用implementation</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">groovy</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation files(<span class="string">'libs/compilexx.jar</span></span><br></pre></td></tr></tbody></table></figure></div>
</li>
<li><h5 id="编译配置"><a href="#编译配置" class="headerlink" title="编译配置"></a>编译配置</h5><p>eclispe编译配置可在mainifest文件中查看，然后在build.gradle相应配置就行。</p>
</li>
</ul>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>Gralde的学习应远不止与此，重在实践与理解。</p>
<p>本文涉及到的相关源码已整理开源到github</p>
<h3 id="示例-androidgradle"><a href="#示例-androidgradle" class="headerlink" title="示例-androidgradle"></a><a href="https://github.com/lairdli/AndroidGradle" target="_blank" rel="noopener">示例-androidgradle</a></h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">http</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight http"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">https://github.com/lairdli/AndroidGradle</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="在线浏览-androidgradle"><a href="#在线浏览-androidgradle" class="headerlink" title="在线浏览-androidgradle"></a><a href="https://www.jianshu.com/p/5c19dd7cdea8" target="_blank" rel="noopener">在线浏览-androidgradle</a></h3><div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">http</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight http"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">https://www.jianshu.com/p/5c19dd7cdea8</span></span><br><span class="line"><span class="attribute">https://juejin.im/post/5e09feaf6fb9a016230ade1b</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://www.groovy-lang.org/documentation.html#gettingstarted" target="_blank" rel="noopener">Groovy-Lang-Doc</a></li>
<li><a href="https://gradle.org/guides/#getting-started" target="_blank" rel="noopener">Gradle Tutorials and Guides</a></li>
<li><a href="https://blog.csdn.net/Innost/article/details/48228651" target="_blank" rel="noopener">深入理解Android之Gradle</a></li>
<li><a href="https://www.cnblogs.com/lwbqqyumidi/p/10322034.html" target="_blank" rel="noopener">Gradle中的闭包</a></li>
<li><a href="http://liuwangshu.cn/tags/Gradle核心思想/" target="_blank" rel="noopener">Gradle核心思想</a></li>
<li><a href="http://liuwangshu.cn/tags/Android-Gradle/" target="_blank" rel="noopener">Android Gradle</a></li>
<li><a href="https://www.cnblogs.com/AsionTang/p/5974254.html" target="_blank" rel="noopener">Gradle-AAR配置</a></li>
<li><a href="https://segmentfault.com/a/1190000004229002" target="_blank" rel="noopener">Gradle for Android</a></li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:laird.li@foxmail.com">laird.li</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://lairdli.top/2020/02/02/Android-Gradle/">https://lairdli.top/2020/02/02/Android-Gradle/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://lairdli.top">黎子的小屋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Android/">Android    </a><a class="post-meta__tags" href="/tags/Gradle/">Gradle    </a></div><div class="post_share"><div class="social-share" data-image="https://s1.ax1x.com/2020/05/18/YW0odg.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/04/25/Script-Svn2Git/"><img class="prev_cover lazyload" data-src="https://s1.ax1x.com/2020/06/08/tfP01J.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>脚本工具-仓储迁移svn转git脚本</span></div></a></div><div class="next-post pull_right"><a href="/2019/11/24/Soft-Team-Manager/"><img class="next_cover lazyload" data-src="https://s2.ax1x.com/2020/03/07/3jO6ER.md.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>部门协作-团队组建与管理</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2021/07/13/Android-Logcat/" title="Android开发-logcat常用命令行汇总"><img class="relatedPosts_cover lazyload" data-src="https://z3.ax1x.com/2021/07/14/WV8LCR.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-07-13</div><div class="relatedPosts_title">Android开发-logcat常用命令行汇总</div></div></a></div><div class="relatedPosts_item"><a href="/2019/08/13/Android-Command/" title="Android开发-常用Linux命令行工具梳理"><img class="relatedPosts_cover lazyload" data-src="https://s2.ax1x.com/2020/03/07/3jOph6.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-08-13</div><div class="relatedPosts_title">Android开发-常用Linux命令行工具梳理</div></div></a></div><div class="relatedPosts_item"><a href="/2019/07/09/Android-Tv/" title="Android开发-TV电视/机顶盒相关技术点梳理"><img class="relatedPosts_cover lazyload" data-src="https://s2.ax1x.com/2020/03/08/3vc51P.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-07-09</div><div class="relatedPosts_title">Android开发-TV电视/机顶盒相关技术点梳理</div></div></a></div><div class="relatedPosts_item"><a href="/2019/06/29/Android-Material-Design/" title="Android开发-Material Design技术点"><img class="relatedPosts_cover lazyload" data-src="https://s2.ax1x.com/2020/03/07/3jO3uQ.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-06-29</div><div class="relatedPosts_title">Android开发-Material Design技术点</div></div></a></div><div class="relatedPosts_item"><a href="/2019/06/24/Android-Release/" title="Android开发-版本进化以及差异梳理"><img class="relatedPosts_cover lazyload" data-src="https://s2.ax1x.com/2020/03/08/3vcWtA.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-06-24</div><div class="relatedPosts_title">Android开发-版本进化以及差异梳理</div></div></a></div><div class="relatedPosts_item"><a href="/2019/06/18/Android-Helper/" title="Android开发-常用工具软件梳理"><img class="relatedPosts_cover lazyload" data-src="https://s2.ax1x.com/2020/03/08/3vc4pt.md.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2019-06-18</div><div class="relatedPosts_title">Android开发-常用工具软件梳理</div></div></a></div></div><div class="clear_both"></div></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">©2019 - 2022 By laird.li</div><div class="icp"><a href="https://beian.miit.gov.cn" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"><span>鄂ICP备2022004589号</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script type="text/javascript" charset="utf-8" src="/js/lazyload-plugin/lazyload.intersectionObserver.min.js"></script></body></html>